  # 剧情详情页面设计需求文档

  ## 📋 页面概述

  **页面名称：** 剧情详情页面（StoryDetail）

  **功能定位：** 展示单个剧情的完整内容，包括剧情条目、角色信息、标签管理、公会归档等

  **设计风格：** Swiss/International Style + 中世纪奇幻风格
- **核心理念：** 几何简洁、网格系统、功能至上
- **视觉特征：** 直角硬边、方形阴影、切角装饰、等宽字体
- **色彩基调：** 温暖的棕色系，古朴典雅
- **交互反馈：** 精确的位移动画、清晰的状态变化

  **路由：** `/archives/:id`

  ---

  ## 🎯 核心功能需求

  ### 1. 页面头部区域

  #### 返回按钮
  - **位置：** 左上角独立区域
  - **样式：** 透明背景，左箭头图标 + "返回剧情列表"文字
  - **颜色：** 次要文字色 `#8D7B68`，悬停变为主色 `#2C1810`
  - **交互：**
    - 如果从公会剧情页进入，返回公会剧情页
    - 否则返回剧情归档主页

  #### 剧情信息卡片
  **布局：** 白色卡片，内边距 24px

**Swiss 风格特征：**
- **切角效果：** 右上角切角（chamfered-top-right）
  - clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% 100%, 0 100%)
- **方形阴影：** shadow-swiss
  - box-shadow: 4px 4px 0px 0px rgba(44, 24, 16, 0.1)
- **边框：** 左边框 2px + 底边框 2px，颜色 `#2C1810` 20% 透明度
- **几何装饰：** 卡片四角添加小方框装饰
  - 右上角：2px 边框，4px × 4px
  - 左下角：2px 边框，4px × 4px

  **左侧信息区：**
  - **剧情标题**
    - 字体：24px，加粗
    - 颜色：主色 `#2C1810`
    - 位置：卡片顶部

  - **剧情描述**
    - 字体：14px，常规
    - 颜色：次要文字 `#8D7B68`
    - 行高：1.6
    - 显示：完整描述或"暂无描述"

  - **元数据**
    - 创建时间：时钟图标 + 格式化日期
    - 字体：13px
    - 颜色：次要文字 `#8D7B68`

  - **标签区域**
    - 位置：元数据下方，margin-top: 12px
    - 标签样式（Swiss风格）：
      - 圆角：0px（直角）
      - 内边距：2px 6px
      - 边框：1px 实线，使用标签颜色
      - 背景：标签颜色 10% 透明度
      - 文字：标签颜色 100%，大写字母
      - 字体：10px，等宽字体（font-mono），加粗
    - 删除按钮：标签内右侧，X 图标，悬停显示
    - 添加按钮：虚线边框，"+ 添加标签"文字

  - **公会归档区域**
    - 显示条件：已归档到至少一个公会
    - 标签文字："已归档到:"
    - 公会徽章：
      - 边框：1.5px 实线，使用公会颜色
      - 圆角：12px
      - 背景：金棕色 5% 透明度
      - 删除按钮：X 图标，悬停显示

  **右侧操作区：**
  - **按钮组：** 垂直或水平排列，间距 8px
  - **按钮列表：**
    1. 编辑 - 编辑剧情标题和描述
    2. 添加条目 - 打开添加条目对话框
    3. 归档到公会 - 图标 + 文字
    4. 导出 - 下载图标 + 文字
    5. 导入 - 上传图标 + 文字
    6. 公开分享 / 取消公开 - 主要按钮样式
    7. 分享（仅公开时显示）- 分享图标 + 文字

  - **按钮样式（Swiss风格）：**
    - 边框：2px 实线，颜色 `#2C1810`
    - 背景：白色（次要按钮）/ `#804030`（主要按钮）
    - 文字：大写字母，字体 12px 加粗
    - 内边距：12px 16px
    - 圆角：0px（直角）
    - 阴影：shadow-swiss (4px 4px 0px rgba(44, 24, 16, 0.1))
    - 悬停效果：shadow-swiss-hover (2px 2px 0px)
    - Active状态：
      - 阴影消失 (0px 0px 0px)
      - 位移：translate(2px, 2px)
      - 模拟按钮被按下的效果

  ---

  ### 2. 剧情条目列表区域

  #### 区域样式（Swiss风格）
  - **背景：** 白色 `#FFFFFF` / 半透明背景 `rgba(238, 217, 196, 0.5)`
  - **圆角：** 0px（直角）
  - **内边距：** 24px
  - **边框：** 2px 实线，颜色 `#2C1810` 10% 透明度
  - **几何装饰：** 右上角和左下角添加小方框装饰（4px × 4px）

  #### 列表标题（Swiss风格）
  - **格式：** "STORY CONTENT (X)" - 大写字母，等宽字体
  - **字体：** 18px，加粗，font-mono
  - **颜色：** 主色 `#2C1810`
  - **字母间距：** tracking-wide (0.05em)
  - **margin-bottom：** 20px

  #### 单个条目卡片

  **整体布局（Swiss风格）：**
  - **排列方式：** 垂直列表，间距 12px
  - **背景：**
    - 未读：`#FFF9F0`（浅米色）
    - 已读：白色 `#FFFFFF`
  - **圆角：** 0px（直角）
  - **内边距：** 20px
  - **边框：** 1px 实线，颜色 `#2C1810` 20% 透明度
  - **布局：** Flexbox 横向排列
  - **悬停效果：** 边框颜色变为 `#804030`（棕红色）
  - **未读标记：** 右上角三角形装饰（铜色 `#B87333`）

  **头像区域（左侧）：**
  - **尺寸：** 40px × 40px
  - **圆角：** 8px
  - **显示逻辑：**
    - NPC：灰色背景 + "NPC" 文字
    - 旁白：灰色背景 + "旁白" 文字
    - 有头像：显示 WoW 图标
    - 无头像：显示说话者首字母
  - **交互：**
    - 非旁白条目可点击
    - 悬停时放大 1.1 倍 + 阴影
    - 点击显示角色信息卡片

  **内容区域（中间）：**
  - **flex：** 1（占据剩余空间）

  - **条目头部：**
    - 说话者名称：
      - 字体：14px，加粗
      - 颜色：使用角色自定义颜色或默认主色
    - 频道标签：
      - 格式：[说]/[喊]/[密语] 等
      - 字体：12px
      - 颜色：根据频道类型变化
        - 说：默认金棕色
        - 喊：红色 `#FF3333`
        - 密语：紫色 `#B39DDB`
    - 时间戳：
      - 位置：右对齐
      - 字体：12px
      - 颜色：次要文字 `#8D7B68`

  - **条目内容：**
    - 字体：14px，常规
    - 颜色：根据频道类型变化（同上）
    - 行高：1.6
    - 空白处理：pre-wrap（保留换行）

  **操作按钮区域（右下角）：**
  - **显示：** 悬停时显示，opacity 0 → 1
  - **位置：** 绝对定位，right: 12px, bottom: 12px
  - **按钮：**
    - 编辑按钮：铅笔图标
    - 删除按钮：垃圾桶图标，悬停变红色
  - **样式：**
    - 尺寸：28px × 28px
    - 圆角：4px
    - 背景：半透明黑色
    - 悬停：金棕色背景（编辑）/ 红色背景（删除）

  **特殊样式：**
  - **旁白条目：**
    - 背景：金棕色 5% 透明度
    - 左边框：3px 实线金棕色
    - 头像背景：深棕色

  ---

  ### 3. 对话框功能

  #### 添加条目对话框
  **标题：** "添加条目"
  **宽度：** 500px

  **表单字段：**
  1. **类型选择（下拉框）**
    - 选项：对话 / 旁白
    - 默认：对话

  2. **频道选择（下拉框）**
    - 选项：说 / 喊 / 密语 / 表情 / 小队 / 团队
    - 默认：说

  3. **时间选择（日期时间输入框）**
    - 类型：datetime-local
    - 精度：秒
    - 提示：留空则使用当前时间

  4. **人物卡选择（下拉框）**
    - 选项：不关联 / 人物卡列表
    - 显示：角色名称 + (NPC) 标记
    - 功能：选择后自动填充说话者名称

  5. **说话者（文本输入框）**
    - 占位符：角色名称
    - 可手动输入或由人物卡自动填充

  6. **内容（富文本编辑器）**
    - 最小高度：120px
    - 简化模式：基础格式化功能
    - 占位符：输入内容...

  **底部按钮：**
  - 取消（次要按钮）
  - 添加（主要按钮，加载状态）

  #### 编辑条目对话框
  - 与添加条目对话框相同布局
  - 标题改为"编辑条目"
  - 预填充现有数据
  - 底部按钮改为"取消"和"保存"

  #### 标签管理对话框
  **标题：** "管理标签"
  **宽度：** 500px

  **内容：**
  - 使用 TagSelector 组件
  - 显示已选标签和可用标签
  - 支持添加、移除、创建新标签

  #### 公会归档对话框
  **标题：** "归档到公会"
  **宽度：** 500px

  **内容：**
  - 空状态：
    - 提示文字："暂无可归档的公会，请先加入公会"
    - 居中显示，padding: 60px 20px

  - 公会列表：
    - 卡片式布局，间距 8px
    - 每个公会卡片：
      - 边框：1px 实线
      - 圆角：8px
      - 内边距：12px 16px
      - 悬停：边框变金棕色 + 背景变浅
    - 公会信息：
      - 名称：15px 加粗，使用公会颜色
      - 描述：13px 次要文字
    - 右侧箭头图标

  #### 分享对话框
  **标题：** "分享剧情"
  **宽度：** 450px

  **内容：**
  - 提示文字："剧情已公开，任何人都可以通过以下链接查看"
  - 分享链接输入框：
    - 只读
    - 浅色背景
    - 右侧"复制链接"按钮
  - 统计信息：
    - 眼睛图标 + 浏览次数

  #### 导入对话框
  **标题：** "导入剧情数据"
  **宽度：** 480px

  **内容：**
  - 提示文字："选择一个 JSON 文件导入剧情条目。导入的条目将追加到当前剧情中。"
  - 文件上传区域：
    - 虚线边框
    - 上传图标（32px）
    - 提示文字或文件名
    - 悬停效果：边框变金棕色

  #### 角色信息卡片
  **显示方式：** 浮动卡片，定位在点击的头像附近

  **内容：**
  - 角色头像（80px）
  - 角色名称（使用自定义颜色）
  - 头衔（斜体，金棕色）
  - 种族 / 职业
  - 其他属性（年龄、身高、眼睛颜色等）
  - 底部"编辑"按钮

  #### 编辑角色对话框
  **标题：** "编辑角色信息"
  **宽度：** 560px

  **表单字段：**
  1. 自定义头像（头像选择器）
  2. 显示名称 + 名字颜色（两列布局）
  3. 头衔 + 全名头衔
  4. 种族 + 职业
  5. 年龄 + 身高
  6. 眼睛颜色 + 居住地
  7. 出生地

  **原始信息区域：**
  - 浅色背景卡片
  - 显示 TRP3 原始数据
  - 只读展示

  ---

  ### 4. 状态处理

  #### 加载状态
  - **显示：** 旋转图标 + "加载中..."
  - **图标：** `ri-loader-4-line` 带旋转动画
  - **颜色：** 次要文字 `#8D7B68`
  - **字体：** 16px
  - **位置：** 居中，padding: 60px

  #### 空状态（无条目）
  - **显示：** "暂无内容，点击上方'添加条目'开始记录"
  - **颜色：** 次要文字 `#8D7B68`
  - **位置：** 居中，padding: 40px

  ---

  ## 🎨 配色方案

  ### 主色系
  - **深棕色** `#2C1810` - 主标题、重要文字
  - **棕红色** `#804030` - 主要按钮、强调元素
  - **金棕色** `#B87333` - 悬停状态、边框高亮、图标
  - **浅金棕** `#D4A373` - 徽章、标签

  ### 辅助色系
  - **中灰棕** `#8D7B68` - 次要文字、说明文字、时间戳
  - **深灰棕** `#4B3621` - 正文文字
  - **浅灰棕** `#8C7B70` - 禁用状态、占位符

  ### 背景色系
  - **页面背景** `#EED9C4` - 页面主背景
  - **卡片背景** `#FFFFFF` - 卡片、弹窗
  - **浅色背景** `#F5EFE7` - 条目背景、输入框背景

  ### 边框色系
  - **主边框** `#E5D4C1` - 卡片边框、输入框边框
  - **分割线** `#F5EFE7` - 内容分割线
  - **高亮边框** `#B87333` - 聚焦状态、选中状态

  ### 频道颜色
  - **说** - 默认颜色
  - **喊** `#FF3333` - 红色
  - **密语** `#B39DDB` - 紫色
  - **表情** `#FF8C00` - 橙色
  - **小队** `#AAAAFF` - 蓝色
  - **团队** `#FF7F00` - 橙色

  ### WoW 职业颜色（用于角色名字颜色选择器）
  - 死亡骑士 `#C41E3A`
  - 德鲁伊 `#FF7C0A`
  - 猎人 `#AAD372`
  - 法师 `#3FC7EB`
  - 武僧 `#00FF98`
  - 圣骑士 `#F48CBA`
  - 牧师 `#FFFFFF`
  - 盗贼 `#FFF468`
  - 萨满 `#0070DD`
  - 术士 `#8788EE`
  - 战士 `#C69B6D`
  - 恶魔猎手 `#A330C9`
  - 部落红 `#FF3333`
  - 联盟蓝 `#0066FF`
  - 金色 `#FFD700`
  - 铜色 `#B87333`

  ---

  ## 🎭 交互效果

  ### 悬停效果
  - **卡片悬停：** 无（剧情信息卡片静态）
  - **按钮悬停：** 背景色加深，光标变为手型
  - **条目悬停：** 显示操作按钮（opacity 0 → 1）
  - **头像悬停：** 放大 1.1 倍 + 阴影（仅可点击的头像）
  - **标签删除按钮悬停：** opacity 0.6 → 1
  - **输入框聚焦：** 边框变为高亮边框色 `#B87333`

  ### 动画效果
  - **加载图标：** 360° 旋转，1s 线性循环
  - **头像缩放：** transform 0.2s ease
  - **按钮过渡：** all 0.2s ease
  - **操作按钮显示：** opacity 0.2s ease

  ---

  ## 📐 布局规范

  ### 响应式要求
  - **页面最大宽度：** 无限制（跟随父容器）
  - **卡片间距：** 20px
  - **内边距：** 20-24px
  - **条目间距：** 16px

  ### 间距系统
  - **xs：** 4px - 小元素间距
  - **sm：** 8px - 按钮组间距、标签间距
  - **md：** 12px - 表单字段间距
  - **lg：** 16px - 条目间距、表单行间距
  - **xl：** 20px - 卡片间距
  - **2xl：** 24px - 卡片内边距

  ### 字体规范
  - **大标题：** 24px，加粗（font-weight: 600）
  - **中标题：** 18px，加粗（font-weight: 600）
  - **正文：** 14px，常规（font-weight: 400）
  - **说明文字：** 12-13px，常规
  - **小文字：** 10-12px，常规

  ---

  ## 🔧 技术实现要点

  ### 数据加载
  1. 并行加载剧情信息、条目列表、标签、公会归档
  2. 根据条目中的 character_id 批量加载角色信息
  3. 使用 Map 缓存角色数据，避免重复请求

  ### 路由处理
  - 支持从公会剧情页进入（携带 from=guild 和 guildId 参数）
  - 返回时根据来源跳转到正确页面

  ### 导出功能
  - 导出格式：JSON
  - 包含：剧情信息、条目列表、角色信息、标签
  - 使用 Tauri 文件保存对话框

  ### 导入功能
  - 支持导入 JSON 格式的剧情数据
  - 条目追加到当前剧情
  - 验证文件格式

  ### 角色关联
  - 条目可关联人物卡
  - 自动填充说话者名称
  - 显示角色头像和颜色
  - 点击头像查看角色详情

  ---

  ## 📝 补充说明

  ### 设计原则
  1. **信息层次清晰：** 头部信息 → 操作按钮 → 条目列表
  2. **交互反馈及时：** 悬停、点击、加载状态明确
  3. **视觉一致性：** 与公会剧情页面保持统一风格
  4. **功能完整性：** 支持完整的 CRUD 操作

  ### 用户体验
  1. **快速操作：** 常用功能（添加条目、编辑）一键可达
  2. **信息可见：** 重要信息（标签、公会归档）突出显示
  3. **错误预防：** 删除操作需要确认
  4. **数据安全：** 支持导出备份

  ### 可访问性
  1. 所有交互元素有明确的悬停状态
  2. 按钮有清晰的文字或图标说明
  3. 表单字段有标签和提示
  4. 颜色对比度符合 WCAG 标准

  ---

  **文档位置：** `docs/剧情详情页面设计需求.md`
  **当前状态：** 功能已完整实现，此文档用于 UI 设计参考
  **最后更新：** 2026-01-18
