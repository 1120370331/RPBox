# 帖子详情页 - 功能需求文档

## 页面标识
- **页面名称**：帖子详情页
- **路由路径**：`/community/post/:id`
- **页面类型**：详情页
- **访问权限**：公开（未登录可浏览）

---

## 一、功能性需求

### 1.1 帖子内容展示

**头部信息**
- 帖子标题（大号字体）
- 作者信息：
  - 头像（可点击跳转用户主页）
  - 昵称（可点击跳转用户主页）
  - 发布时间（相对时间，如"3小时前"）
  - 关注按钮（需登录）
- 关联公会（如果有）：
  - 公会图标
  - 公会名称（可点击跳转）

**正文内容**
- 富文本内容展示
- 支持图片、链接、格式化文本
- 图片点击放大查看
- 代码块语法高亮（如果有）

**标签列表**
- 显示所有标签
- 点击标签跳转到社区广场并筛选该标签

**互动数据**
- 点赞数、评论数、收藏数
- 浏览数

### 1.2 互动功能区

**操作按钮**
- 点赞按钮（未登录显示登录提示）
- 收藏按钮（未登录显示登录提示）
- 分享按钮（复制链接）
- 举报按钮（需登录）

**作者专属操作**（仅作者本人可见）
- 编辑按钮（引导下载客户端）
- 删除按钮（引导下载客户端）

### 1.3 评论区功能

**评论列表**
- 按时间倒序显示
- 每条评论包含：
  - 评论者头像、昵称
  - 评论时间
  - 评论内容
  - 点赞数
  - 回复按钮（需登录）
  - 删除按钮（仅评论者本人可见）

**发表评论**
- 评论输入框（需登录）
- 字数限制：500字
- 实时字数统计
- 发布按钮
- 未登录显示"登录后参与讨论"

**评论分页**
- 初始加载20条
- "加载更多"按钮
- 评论总数显示

**评论回复**
- 点击回复按钮，输入框自动聚焦
- 显示"回复 @用户名"
- 回复内容缩进显示

### 1.4 侧边栏功能

**作者信息卡片**
- 作者头像
- 昵称
- 个人简介
- 帖子数、粉丝数
- 关注按钮（需登录）
- "查看主页"链接

**相关帖子**
- 显示同标签的其他帖子（5条）
- 显示标题、作者、发布时间
- 点击跳转到对应帖子

**推荐公会**
- 如果帖子关联了公会，显示该公会信息
- 如果没有，显示推荐公会（3个）

---

## 二、系统配色方案

### 2.1 主色调
```css
/* 主色系 */
--color-primary: #4B3621      /* 深棕色 - 主要文字 */
--color-accent: #B87333       /* 铜色 - 链接、按钮 */
--color-secondary: #856a52    /* 中棕色 - 次要文字 */

/* 背景色 */
--color-bg-page: #EED9C4      /* 羊皮纸色 - 页面背景 */
--color-bg-content: #fff      /* 白色 - 内容背景 */
--color-bg-comment: #f5f0eb   /* 浅米色 - 评论背景 */

/* 边框色 */
--color-border: #e5d4c1       /* 浅边框 */
--color-divider: #d4a373      /* 分割线 */
```

### 2.2 功能色
```css
/* 互动功能 */
--color-like: #e74c3c         /* 点赞 - 红色 */
--color-like-active: #c0392b  /* 已点赞 */
--color-favorite: #f39c12     /* 收藏 - 橙色 */
--color-favorite-active: #d68910 /* 已收藏 */
--color-share: #3498db        /* 分享 - 蓝色 */

/* 状态色 */
--color-success: #28a745      /* 成功 */
--color-warning: #f57c00      /* 警告 */
--color-error: #e74c3c        /* 错误 */
```

### 2.3 文字色
```css
--text-primary: #4B3621       /* 主要文字 */
--text-secondary: #856a52     /* 次要文字 */
--text-tertiary: #a89984      /* 辅助文字（时间等） */
--text-link: #B87333          /* 链接文字 */
```

---

## 三、数据接口需求

### 3.1 获取帖子详情
```
GET /api/v1/posts/:id
返回：完整的帖子信息，包括作者信息、标签、公会等
```

### 3.2 获取评论列表
```
GET /api/v1/posts/:id/comments
Query参数：
- page: 页码
- limit: 每页数量

返回：
{
  comments: Comment[],
  total: number,
  has_more: boolean
}
```

### 3.3 发表评论
```
POST /api/v1/posts/:id/comments
Body: { content: string, parent_id?: number }
```

### 3.4 删除评论
```
DELETE /api/v1/comments/:id
```

### 3.5 点赞评论
```
POST /api/v1/comments/:id/like
DELETE /api/v1/comments/:id/like
```

### 3.6 关注作者
```
POST /api/v1/users/:id/follow
DELETE /api/v1/users/:id/follow
```

### 3.7 获取相关帖子
```
GET /api/v1/posts/:id/related
返回：5条相关帖子
```

---

## 四、特殊场景处理

### 4.1 帖子不存在
- 显示404页面
- 提示"帖子不存在或已被删除"
- 提供返回社区广场的链接

### 4.2 帖子已被删除
- 显示提示信息
- 保留标题和基本信息
- 内容区域显示"该帖子已被作者删除"

### 4.3 帖子仅公会成员可见
- 非成员显示"该帖子仅公会成员可见"
- 提供申请加入公会的链接

### 4.4 评论被删除
- 显示"该评论已被删除"
- 保留评论位置（避免楼层混乱）

---

## 五、性能要求

- 页面加载时间 < 2秒
- 图片懒加载
- 评论分页加载
- 点赞/收藏操作乐观更新

---

## 六、其他说明

**移动端适配**
- 侧边栏移至底部
- 评论输入框固定在底部
- 操作按钮改为浮动按钮

**SEO优化**
- 页面标题：{帖子标题} - RPBox社区
- Meta描述：帖子摘要（前150字）
- Open Graph标签（社交分享）

**分享功能**
- 复制链接到剪贴板
- 显示"链接已复制"提示
- 链接格式：https://rpbox.app/community/post/{id}
