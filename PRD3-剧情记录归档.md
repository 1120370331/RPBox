# PRD3: RP剧情记录归档

## 1. 概述

### 1.1 背景
魔兽世界的RP活动包含大量玩家创作的文字对话和场景描述，这些内容是玩家的心血结晶。然而：
- 游戏内聊天记录有限，重启后丢失
- 现有聊天记录插件（如Prat、WIM）仅做短期存储
- 缺乏按剧情线、活动归档的能力

### 1.2 目标
提供RP剧情的长期归档方案，支持：
- 自动采集游戏内RP对话
- 按活动/剧情线组织归档
- 支持后期编辑和整理
- AI辅助生成剧情总结

## 2. 用户故事

| 编号 | 故事 | 优先级 |
|------|------|--------|
| US-01 | 我想自动保存RP活动中的所有对话 | P0 |
| US-02 | 我想按活动/剧情线整理我的RP记录 | P0 |
| US-03 | 我想编辑和补充剧情记录 | P1 |
| US-04 | 我想用AI生成剧情摘要 | P2 |

## 3. 功能需求

### 3.1 聊天采集 (P0)

> **前置依赖**：配套 WoW 插件，详见 [PRD6-配套WoW插件.md](PRD6-配套WoW插件.md)

**客户端功能：**
- 读取并解析 `RPBox_ChatLog` SavedVariables
- 导入到本地数据库
- 支持手动/自动同步

### 3.2 剧情归档 (P0)

**归档助手界面：**
```
┌─────────────────────────────────────────────────────┐
│  今日聊天记录 - 2024-01-11        [☐ 全选] [同步]   │
├─────────────────────────────────────────────────────┤
│  ▼ 20:00 - 20:59  (32条)                   [☐ 全选] │
│    ☑ [艾琳] 说: 今晚的月色真美...                    │
│    ☑ [索林] 表情: 点燃了篝火                         │
│    ☐ [路人] 说: 有人组本吗                          │
│                                                     │
│  ▼ 21:00 - 21:59  (48条)                   [☐ 全选] │
│    ☑ [艾琳] 说: 你听说过银月城的传说吗               │
│    ...                                              │
├─────────────────────────────────────────────────────┤
│  归档到: [选择剧情 ▼]  [+ 新建剧情]                  │
│                                                     │
│  已选 28 条对话        [归档选中内容]                │
└─────────────────────────────────────────────────────┘
```

**功能点：**
- 按日期分组、按小时折叠展示
- 勾选框批量选择对话
- **支持按小时/按天一键全选**
- 智能过滤（排除非RP内容）
- 关联到已有剧情或新建剧情

### 3.3 内容编辑 (P1)
- 富文本编辑器
- 添加场景描述、旁白
- 插入图片/截图
- 标记重要对话

### 3.4 AI摘要 (P2)
- 自动生成剧情摘要
- 提取关键人物和事件
- 生成时间线

## 4. 数据结构

```typescript
interface Story {
  id: string;
  userId: number;
  title: string;
  description: string;
  participants: string[];  // 参与角色
  tags: string[];
  startTime: Date;
  endTime: Date;
  status: 'draft' | 'published';
}

interface StoryEntry {
  id: string;
  storyId: string;
  type: 'dialogue' | 'narration' | 'image';
  speaker?: string;
  content: string;
  timestamp: Date;
}
```

## 5. 里程碑

| 阶段 | 功能 |
|------|------|
| M1 | 聊天日志解析 + 本地存储 |
| M2 | 活动创建 + 归档管理 |
| M3 | 富文本编辑 |
| M4 | AI摘要生成 |
