# SYNC-0001: Lua解析器核心

| 属性 | 值 |
|------|-----|
| ID | SYNC-0001 |
| 类型 | DEV |
| 优先级 | P0 |
| 状态 | TODO |
| 模块 | client/src-tauri |
| 依赖 | 无 |

---

## 1. 目标

实现 Lua 解析器，解析 TRP3 SavedVariables 文件。

**数据结构参考**: PRD2 - 5.2 数据结构

---

## 2. 接口设计

```rust
// lua_parser/mod.rs

pub fn parse_variable(path: &Path, var_name: &str)
    -> Result<serde_json::Value, LuaParseError>;

#[derive(Debug, thiserror::Error)]
pub enum LuaParseError {
    #[error("文件不存在: {0}")]
    FileNotFound(PathBuf),
    #[error("语法错误 (行{line}): {message}")]
    SyntaxError { line: usize, message: String },
    #[error("变量不存在: {0}")]
    VariableNotFound(String),
}
```

```rust
// Tauri Command
#[tauri::command]
pub async fn parse_trp3_file(path: String, variable: String)
    -> Result<serde_json::Value, String>;
```

---

## 3. Lua语法支持

| 语法 | 示例 |
|------|------|
| 字符串键 | `["key"] = value` |
| 标识符键 | `key = value` |
| 隐式数组 | `{a, b, c}` |
| 转义字符 | `\n \t \" \\` |
| 注释 | `-- comment` |

---

## 4. 验收标准

- [ ] 解析 TRP3_Profiles / TRP3_Register / TRP3_Extended / TRP3_Tools_DB
- [ ] 正确处理 UTF-8 中文
- [ ] 解析 1MB 文件 < 100ms
- [ ] 单元测试覆盖率 > 90%

**测试用例参考**: PRD2 - 8.2.1 Lua解析器测试
